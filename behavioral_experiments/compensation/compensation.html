<!-- For help on using this template, see the blog post: http://mechanicalturk.typepad.com/blog/2014/04/editing-the-survey-link-project-template-in-the-ui.html --><!-- Bootstrap v3.0.3 -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<link href="https://s3.amazonaws.com/mturk-public/bs30/css/bootstrap.min.css" rel="stylesheet" />
<section class="container" id="SurveyLink" style="margin-bottom:15px; padding: 10px 10px; font-family: Verdana, Geneva, sans-serif; color:#333333; font-size:0.9em;">
  <div class="row col-xs-12 col-md-12"><!-- Instructions -->
    <div class="panel panel-primary">
      <div class="panel-heading"><strong>Instructions</strong></div>

      <div class="panel-body">

	<p> I sent you an email with a code. If you put it in below, you will receive compensation for your participation </p>

	<p> Thank you for your valuable work, and let me know if any problems remain. </p>
      </div>
    </div>
    <!-- End Instruction -->

    <table>
      <tbody>
	<tr>
	  <td><strong>Provide the code here:</strong></td>
	  <td style="vertical-align: middle;"><input class="form-control" id="surveycode" name="surveycode" placeholder="e.g. 5872-dd5b23c4-f1c6-433c-9de2-50ad90b5953f" type="text" /></td>
	</tr>
      </tbody>
    </table>
  </div>

  
  
    <form id="mturk_form" method="POST" action="https://mturk.com/mturk/externalSubmit">
    <input type="hidden" id="assignmentId" name="assignmentId" value="<%=assignmentId %>">
    <input type="hidden" id="code" name="code" value="">
    <input type="hidden" id="comments" name="comments" value="">

  </form>

    <button type="button" id="submitButton" value="Submit to MTurk" onclick="submissionFunc()" style="display: none;"> Submit to MTurk! </button>

  <div> <p id="error" style="display: none"> This code is incorrect -- please try again </p> </div>
  <script>
    var urlParams;
    var match,
        pl     = /\+/g,  // Regex for replacing addition symbol with a space
        search = /([^&=]+)=?([^&]*)/g,
        decode = function (s) { return decodeURIComponent(s.replace(pl, " ")); },
        query  = location.search.substring(1);

    urlParams = {};
    while (match = search.exec(query))
       urlParams[decode(match[1])] = decode(match[2]);

    if(urlParams.assignmentId != "ASSIGNMENT_ID_NOT_AVAILABLE") {
        $("#submitButton").show()
        document.getElementById("assignmentId").value = urlParams.assignmentId;
        document.getElementById("mturk_form").action = urlParams.turkSubmitTo + "/mturk/externalSubmit"; 
    }
    

    var submissionFunc = function() {
        var surveyVal = $("#surveycode").val()
        if(surveyVal == "E2iZwi8q") {
            document.forms["mturk_form"].submit();
        } else {
            $("#error").show()
      }
    }
    
  </script>

</section>
<!-- close container section -->
<style type="text/css">td { font-size:1.0em; padding:5px 5px; }
</style>
